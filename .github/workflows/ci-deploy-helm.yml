name: Kubernetes Deployment using helm charts

on:
  workflow_dispatch:
  push:
    branches:
      - main
    paths:
      - 'charts/**.tgz'

jobs:
  check_running_workflows:
    runs-on: ubuntu-latest
    steps:
    - name: Check if any workflows are running
      id: check_workflow_status
      run: |
        response=$(curl -s -X GET \
          -H "Accept: application/vnd.github.v3+json" \
          -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" \
          https://api.github.com/repos/${{ github.repository }}/actions/runs?status=in_progress)
        num_running=$(echo "$response" | jq '.total_count')
        if [ "$num_running" -gt 0 ]; then
          echo "::error::There are other workflows currently running. Aborting deployment."
          exit 1
        else
          echo "No other workflows are running. Proceeding with deployment."
        fi

  deploy:
    needs: check_running_workflows
    runs-on: ubuntu-latest


